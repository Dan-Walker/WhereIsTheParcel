function createModalWindow(a,b){if(!$("#shopping_toolbar_modal_css").length){var c='.shoppingToolbarModalContent{padding: 10px;}html.shoppingToolbarModal-is-locked{overflow:hidden;-ms-touch-action:none;touch-action:none}.shoppingToolbarModal,[data-shoppingToolbarModal-id]{display:none}.shoppingToolbarModal-overlay{position:fixed;z-index:9999;top:-5000px;right:-5000px;bottom:-5000px;left:-5000px;display:none;background-color:rgba(255,255,255,.75)}.shoppingToolbarModal-wrapper{position:fixed;z-index:10000;top:0;right:0;bottom:0;left:0;display:none;overflow:auto;text-align:center;-webkit-overflow-scrolling:touch;padding:10px 10px 0}.shoppingToolbarModal-wrapper:after{display:inline-block;height:100%;margin-left:-.05em;content:""}.shoppingToolbarModal-overlay,.shoppingToolbarModal-wrapper{-webkit-backface-visibility:hidden;backface-visibility:hidden}.shoppingToolbarModal{position:relative;text-align:left;outline:0;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%;font-family:"Helvetica Neue","Lucida Grande",sans-serif;box-sizing:border-box;min-width:500px;max-width:700px;margin-bottom:10px;-webkit-transition:.2s -webkit-transform;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);color:#2b2e38;-webkit-border-radius:3px;background:#fff;box-shadow:0 4px 23px 5px rgba(0,0,0,.2),0 2px 6px rgba(0,0,0,.15);-webkit-box-orient:vertical}.shoppingToolbarModal-is-initialized{display:inline-block}.shoppingToolbarModal-bg.shoppingToolbarModal-is-opened,.shoppingToolbarModal-bg.shoppingToolbarModal-is-opening{-webkit-filter:blur(3px);filter:blur(3px)}.shoppingToolbarModal-overlay.shoppingToolbarModal-is-closing,.shoppingToolbarModal-overlay.shoppingToolbarModal-is-opening{-webkit-animation-duration:.2s;animation-duration:.2s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.shoppingToolbarModal-overlay.shoppingToolbarModal-is-opening{-webkit-animation-name:shoppingToolbarModal-overlay-opening-keyframes;animation-name:shoppingToolbarModal-overlay-opening-keyframes}.shoppingToolbarModal-overlay.shoppingToolbarModal-is-closing{-webkit-animation-name:shoppingToolbarModal-overlay-closing-keyframes;animation-name:shoppingToolbarModal-overlay-closing-keyframes}.shoppingToolbarModal .shoppingToolbarModal-header{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-bottom:solid #d3d3d3 1px;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.shoppingToolbarModal .shoppingToolbarModal-header .shoppingToolbarModal-header-icon{width:32px;height:32px;padding:8px}.shoppingToolbarModal .shoppingToolbarModal-header h1{font-size:14.75px;font-weight:400;margin:0;padding:14px 17px 14px 0;-webkit-user-select:none;color:#333;text-shadow:#fff 0 1px 2px;-webkit-padding-end:24px}.shoppingToolbarModal.shoppingToolbarModal-is-closing,.shoppingToolbarModal.shoppingToolbarModal-is-opening{-webkit-animation-duration:.3s;animation-duration:.3s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.shoppingToolbarModal.shoppingToolbarModal-is-opening{-webkit-animation-name:shoppingToolbarModal-opening-keyframes;animation-name:shoppingToolbarModal-opening-keyframes}.shoppingToolbarModal.shoppingToolbarModal-is-closing{-webkit-animation-name:shoppingToolbarModal-closing-keyframes;animation-name:shoppingToolbarModal-closing-keyframes}.shoppingToolbarModal,.shoppingToolbarModal-wrapper:after{vertical-align:middle}.shoppingToolbarModal-close-button{position:absolute;z-index:1;top:7px;right:7px;width:14px;height:14px;cursor:pointer;background-image:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAUklEQVR4XqXPYQrAIAhAYW/gXd8NJxTopVqsGEhtf+L9/ERU2k/HSMFQpKcYJeNFI9Be0LCMij8cYyjj5EHIivGBkwLfrbX3IF8PqumVmnDpEG+eDsKibPG2JwAAAABJRU5ErkJggg==) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAAcUlEQVR4Xu3UQQrAQAgDQN+cD+jPbU+BuChS6G3JLTAgIlp+zBZcCIO/sRL2PXQk8qDsexhI0soS0UOhlU2jCq1shEqVzVAp2RKSku2hE/oakpEuIVnIhkeoTDc8Q2VKB6jspD2Mwkg3t3oy9n9/gAsfSKXnp9ZyP20AAAAASUVORK5CYII=) 2x);background-repeat:no-repeat;background-position:center}.shoppingToolbarModal-close-button:hover{cursor:pointer;background-image:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAnUlEQVR4XoWQQQ6CQAxFewjkJkMCyXgJPMk7AiYczyBeZEAX6AKctGIaN+bt+trk9wtGQc/IkhnoKGxqqiWxOSZalapWFZ6VrIUDExsN0a5JRBq9LoVOR0eEQMoEhKizXhhsn0p1sCWVo7CwOf1RytPL8CPvwuBUoHL6ugeK30CVD1TqK7V/hdpe+VNChhOzV8xWny/+xosHF8578W/Hmc1OOC3wmwAAAABJRU5ErkJggg==) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAABR0lEQVR4XpXVsY6CQBAG4A0hPJa14V0gFxMSvSiNVkReYWNJIxRYLG+APo0YaEhWjjVyw/3HkDv+bsIXwJkdxQqirMyTZVyFOuiCLtRxJa+Zpyy87yeyE3loV93vHNpEKpuBl0VUG8Alqi+LCZh+bDUCzFZnHsDzJiAwk6A7f45gvtw8AbBZP/PlGyqHvk31QYD1qFbOCyaSmLmIcvXk1ENlUQMK44gSe6UYNUdZIvUNYSgwSuoLWRJDiowiSxFXhJAio8R3EWoiSIlhQi2w8UgLZhAYqL6h4mCoGYYUXzWuOFZAc+DHkVeGYXOwHanPM56mPo0cMp6akbPNkJ/oFmBMvRd4rApgU/WoUc5wkN31fw6yO14duz+vjh2tjjelp/JPMwygeeGomWNRk7szC3nfTqE9v5AJZ568HR/DX8DxIW+ZNyDKF3a0GDYRA14BAAAAAElFTkSuQmCC) 2x)}.shoppingToolbarModal-close-button:active{cursor:pointer;background-image:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAnElEQVR4Xn2QQQqDQAxFcwjrQR6MoDC9hD2RBY9XrL3IaLuwXWg1BgldlLfLS0LyBYWMlp5ppaMh26uqqEksjoFapapZhWfetHBiYKEi2nQiUul0LjRaOiME0kpAiFprhc76C9Vhb1LZCxOL06aUt5fhRz6PtbawcPpuBxGPgwp/UK6vlP4VSnvlfwgbF0avGC0+F/yDDy9uXLHgv9HQnE67Dt6aAAAAAElFTkSuQmCC) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAABTUlEQVR4XpXVsYrCQBAG4CVIHsgmhYcIaSTaLpiHSDi2uwMhnbJVsNo0wceJPo2RpBHWnCt64/2XCXf5uyEfSZzZUYwhxtOJquI6tEEXdKGNa3XQifHwvp9olJXLy7j7neUlK82IgbupbBzgIpvdtAfq95lFgJlZnQDcfgQEBhJ0288XmM/frgDYTK75/AGNT99mbkGAddkY/w6zkpi7iHL1bH+DxqMGFM4RJXZP8dIc4wmdOsJQYBSdClURQ4qMoioR14SQIqPEJxFaIkiJYUIrsPFIC2YQGGi+oeFgaBmGFF81rjlWQHPgx1EHhmFzsB065RlPdUojh4ynbuRGbsj3dAswpn4TeKwKYH112Rr/eZCjyX8OcvSyOjbrv66OzZpWx4PSU/mnOQbQvbBsh5hs82hgIS8ufWjBL2TCOlHH1fn5F7A6q6NOnojyBfK6dXRV1N6jAAAAAElFTkSuQmCC) 2x)}.shoppingToolbarModal-cancel::-moz-focus-inner,.shoppingToolbarModal-close::-moz-focus-inner,.shoppingToolbarModal-confirm::-moz-focus-inner{padding:0;border:0}@-webkit-keyframes shoppingToolbarModal-opening-keyframes{from{-webkit-transform:scale(1.05);transform:scale(1.05);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}@keyframes shoppingToolbarModal-opening-keyframes{from{-webkit-transform:scale(1.05);transform:scale(1.05);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}@-webkit-keyframes shoppingToolbarModal-closing-keyframes{from{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(.95);transform:scale(.95);opacity:0}}@keyframes shoppingToolbarModal-closing-keyframes{from{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(.95);transform:scale(.95);opacity:0}}@-webkit-keyframes shoppingToolbarModal-overlay-opening-keyframes{from{opacity:0}to{opacity:1}}@keyframes shoppingToolbarModal-overlay-opening-keyframes{from{opacity:0}to{opacity:1}}@-webkit-keyframes shoppingToolbarModal-overlay-closing-keyframes{from{opacity:1}to{opacity:0}}@keyframes shoppingToolbarModal-overlay-closing-keyframes{from{opacity:1}to{opacity:0}}@media only screen and (min-width:641px){.shoppingToolbarModal{max-width:700px}}.lt-ie9 .shoppingToolbarModal-overlay{background:#2b2e38}.lt-ie9 .shoppingToolbarModal{width:700px}';c+=".shoppingToolbarModalTrackingItemBlockCourierContent{margin-left:56px;font-size:1.1em}.shoppingToolbarModalTrackingItemBlockCourierImage{width:48px;height:48px;float:left;-webkit-transition:all .4s ease;-moz-transition:all .4s ease;-o-transition:all .4s ease;-ms-transition:all .4s ease;transition:all .4s ease}.shoppingToolbarModalTrackingItemBlock:hover .shoppingToolbarModalTrackingItemBlockCourierImage{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg)}.shoppingToolbarModalTitle{font-size:16px;font-weight:700;margin-bottom:10px;margin-top:10px}.shoppingToolbarModalFooter{border-top:solid #d3d3d3 1px;padding:10px 20px}.shoppingToolbarModalTrackingItemBlock{display:inline-block;margin-right:25px;margin-bottom:20px;cursor:pointer;border:1px solid transparent;padding:5px}.shoppingToolbarModalTrackingItemBlockTitle{display:block;text-transform:uppercase;color:#337ab7}.shoppingToolbarModalTrackingItemBlock:hover{border:1px solid #d3d3d3;-webkit-border-radius:3px;background-color:rgba(255,238,214,.4)}.shoppingToolbarModalTrackingItemBlockCourier{margin-top:3px;font-size:13px;display:inline-block;width:120px;overflow:hidden;text-overflow:ellipsis;text-align:left}",$('<style id="shopping_toolbar_modal_css"></style>').html(c).appendTo($("head"))}if(!$(".shoppingToolbarModal").length){var d=chrome.runtime.getManifest().name,e='<div class="shoppingToolbarModal" data-shoppingToolbarModal-id="modal" role="dialog"><span data-shoppingToolbarModal-action="close" class="shoppingToolbarModal-close-button"></span><div class="shoppingToolbarModal-header"><img class="shoppingToolbarModal-header-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAMJklEQVRogb2ZeZRV1ZXGf/vce99Q71W9mkuKQGSQSQkqRg2TImQwJgETMIpp2zYEs4iajjFSItImSkTSinaiaFpjDEnbDREHugmtS4xChBWJgBg0TCphqKKgqt483Hfv6T9uUTK892qA1d9atWq9d/bZ+/v2Offcvc8TzhD0HQ2hhOl8VqFGgb4ATaWIVANodDuiD6N5x1XsCacDm2Tp/vSZiCunMzn2w8Za07Sv0MKX0YxGGApUdDcN2AVsE+EPdia7LrI01tZXDn0SkLmrdpij5VZgBnBWX4N34qDWrDCVXhZ44MjO3k7ulYDU3TX9taOagJuAst4G68691vwSlwfDP2tt7umkHgtIzKudJSIPcfoZ7wayT+D2ssWHn++RdXcGeg5WqqZuKZrvnT65nkNreTgUPPwjuRe3lF1JAdEfVFSbft9/gUw9s/R6Cnm5LOu7ttSJVVRAR1OkyhL/WrS+uE+xtQbdmTwRENU3N/BmKBn5gvx8d7bQeEGv+l5MC2tFn8i7eUh3oDMxNIIWA21n0cmjkM/02p3ApFQotkIXSXbBL5NN9U+CntOrSNpFZ6IQqMIYPQ1j+BSoHgSGBfFm9P6t5LesRB/ajgTCYPh65x5ZGl58+PZuBXSeNr/rlfdsAq1d1Ojp+D5/F8aAMQXN3FQM+83HyG94DOLNSCACyuhxGEFmnHw6nSAgMb++QVz9LlDfE3fkM+hsEhl4MdYX5mN95ivekNak/rKazK5N6Fwaq99QQp+9GqOqEQDn8G7sVx/Eeec5xM1DoPxkKsVw0BHfZyoeOHC0oIBkU+0ykO92S9zNo9MdUDkQ8/Lv45vwXcQXACC97RXaXlhEdudGdM5GaxATzJoBRK68jciXbkEsz9be9Sb22vvRu9chVhCsMkCXjH7yVuoSEJ/fcJ5y3a1A8TUVgVwSjYFxyY34ptyBqh7gkTm4k/YX7ie56XncTAqxLIxIA2L6cGKHcVMJEPAPGUvVtHmELp3pEdJgb3wG+7UlyNHdEKwqnT/IKlONDN7f8uEJArp9cEUgE0dXDsR37ZNYwy4DwE1Fia55lNgrj+PEjyCBcoLDx1F++T/hO3sMYgXJH/07iU2/J7lpJU70MKApu+DLVH19Af7BYz0/8VYyv78Dd8t/YIarcEsshIZ/Cy9u/X6XgNgPG2sNy94JFJefz6L9Efxz12I2jgIg/sZv6Fj9M3L73gMRlL8MMUyqrvkJkStvO2G6vX8HLY9eh928G+3YaNtGlVdTfvmNVE1vwqioQ7vQtmwWbF9JWbVHRRcW0mqTG165ONpuANw9KThDhOtKadbZBNY3HsUaORVtZ2h9/EY6Vi3C6WjBiNRRPvEfQIR8827S214hs+MNrLpBIEL7yh/T+qtbyB/Zh6qoITzxehDBadlDZudGkm+/SGDoxZi1n8I34jKOvrGKXLQD02dimgUJhUwxNi/akNphAMyfVDZf4Nyi/O000ngB/hmPICK0/ed8YmufQCyL4KhJ1M99hoqpcwiPuwYVjGAf+ZjcR1tJbn6JxFvPkdr2vyh/iNDFV1P/nWVUTP424c/NBITcx1twY61kPthAeNw3MStqIZ8l+uc1ZHUA1xVMCwzjlNXI/HRD6kWjoylSZWA2AXVF85+JYo6/GfOcy7Bb9nLkqbmAg3/QhfRrWoNVPwgAMf0ERkyAfI7M396CfA432YEy/fjPuZSGW5dj1g70bK0AwdFTwXXJfLDeW8nyGgIjJqBClSQ3rUA7eXK2IpMBQbAsUNJ1TsmiqaHfKpPAWNCfLrV9EANVP8yT/f6buKkoiKJqxkJUsLzLMrdvOy1Lr6Ft5b3oTByzdiCBcy5FOzaZv77OgXvGE1+//ATvldPuxDfgPNCQfn89ANZZQ1GhKnBdlALXhWhM09auyWS980QJn86kOV+h3YuAUHH+2isHzKD3MZtAO3ms+kEEho3rMou9+gQHFo4nvn4lAOWfv5l+C16h3z2vUTv7caz6QWT3vsvhX9xA89KZuOlY56r5CI663Kv77EzXdyIGx3ItAkqBbUN7h6YjqrHzRMSU85QII4pn/6SVAK+q1CCBMOILdo0m/vQcTjxOYNhF9LtrDXWzn8CsGYCYFhVXzKbxvreIfHEOYgVIbV6NfWhX11xVUee5F/kkaQVeaCLeXzoNbe2ajqh7ldJwds8EnKznuHIZvDexhsiVtxAYMfEUc6O8hpobHsKI1COGdWINoEv2LKdAKXA15HL6PAX065OAUyCIAvEXb5W1YyOmv8v+9KIBSFip7oqP3sJ1io9pt+ibqS8QUErDkTPm8f8bQlSJyMd9m9z3NvFUX33zI4oDytX6vR6ae/86HzidS6Ptgm1qr+Em2z33vdxejsNrCtgCFG9WRcDJg+ORFV8QMU3yLXvI7t3cd9bH4DpkdrzhLYJ1rM3U6LxdcpoIrojeolCyRcO+Eqag87itewDwDx+PCobRjkP78/ehndKBCkJrxPTIRtf+guxHW0AgMPSSzmEXFarETcY7V7ngibU/aMr7KvzTwy0IW0uq9ZXh7FgDgK9xBOHxs9C2V++0PDyD/JF9xx2P3UNMC51NEnt1GW0r/wW0xmoYRPkVs71xZXLWj16g+tofY1TU4iaOniJEhPfqHjuy0ytWXfkfRF9TNKIZRH+8CXvLKqwLvk71rMXkj+wj9c5/k9r8Mgf3eY+R+H1drWXhRAQRwwQRDi+7Cbt5DzqfxaxspO7mf8es7v9JyJoBVM1YSMXU7xB7/RkSf3wGu2Uv4g8hvgAi7hrobB/nXxZqFs0coHAaRRDt4n60CTV6GkZFPaHPzcQoryV38G/kmz8E7QAaoyxC2ZgvfVIWHIf0e+tIvLkc0OTb9qMsP+GJ19Pwvd/gH3RhwdAqUE5w5ETC46/DKK/Fbt6FGz0U9wfKb39oc6LjuJay7lnghuLpE0jH4KyR+Gb9CnPA+QA4HYdof/FB4m88691QGCaB4ROIXPXP+AePRXxB7ObdJNb/lvgff42bS6OdPMGRE6i6egHB0VMA0NkUHWsewY21UjXzXlRZpCANJ3aE5Ibl6yNX3T4JjttUiXkNo0XcLXTX1GfiaF8Ic/xcrMm3ocI1AGR2/5mOVfeT2roWbduIP4BVOxAsP07bAZx4G2iwPjWcyq/eQcXkm7rO/+TbL9LxwiIye/4CWuMffCHV1y+hrFNcASSAS0Rkx0nXKnW/Bv6xqAA6NTs5dCaGNIzEnHIn1qU3dGUisXEFHS89SPbDLZDvPNcVGJV1VFzxbSJfuxMj5PW72Y+20b7qPlKbXwZloAJhQHDTMUQZVHxxLlXfOLHnOA7TReSlEwXcWduIyF8RKkuL6ISdQttZ1DlTsK5ciDnE6w+0nSWx4Xdk9ryNtrNY9YMIXzoTq79Xuec7DhFd/TDxdU/jZmKossqTnhnv7slJtuMffBE131pC8NzJx0dOAKNE5O+nPGnJprqbgKd7JMCjC5kYWvkwxs7CmnonRv2QwqauQ2zdU3Ss/lfs5j2osohXWpeoJ910HDFMKqbOoWr6vA9URcMe4CEReb1T6qlINdUu18i3ei7CI6czUajojzr/mzBkMqpuCMqycKItZD98h+SfniOzcyNiBU5ohkpD0G4eEu0vpeGac1eSO3G0APStQ/2pUHQdMK7QeEk4Njobx5EgKbecTFa8kycdRSw/yl9WLGxRKKW3hwN6Qs3P22InjxX1FP1BRbUZCPyhrz9wCC5ol2xWk0gKubxCRAq9HkpCKfZYZc4VjY+2Fyx3evATk381fVmJYwEE0JDKQDKpyee9lrBHcxXv+kPmtH6PNH9UzKakq8jSWFtZIDQFeLY3pI+H1t4jGiqDmmohHPZy5nbTBivFS1Xh3ORS5KEXmzHZVDsbZAml7k+7wbFbBduGRMK74zn2/TEoIauUXjjgl0eX9MhnbwikFzQMcvPuAryXXc9/Wjk5aGfUTNbbVrbtbSulZJUlzj39nmzb0WNffSGQmFc/RkTfhsh0tK7uiw/wrgkdV9oSSdZmMs7TZz91dF1vfZzW3Ubq7pr+bt6YIqK/BjIS9GCgeD3tIQ16r0beQ8saZTqvlS06eqCvHE7vcuY4JObXN4jjXqSVOlfBGK31QOm8MNbQKiL7XNgmrt7uKmNz+QPNrWci7v8BN03WYgP1drwAAAAASUVORK5CYII="><h1>'+d+'</h1></div><div class="shoppingToolbarModal-content"></div></div>';$(e).appendTo($("body"))}return $(".shoppingToolbarModal-content").html($(a)),b&&b($(".shoppingToolbarModal")),$(".shoppingToolbarModal").shoppingToolbarModal().open(),null}function checkSiteAllowedForTracking(a,b){chrome.storage.local.get(SETTINGS.local,function(c){c.options&&c.options.tracking_sites&&c.options.tracking_sites[a]&&c.options.tracking_sites[a].track_allowed&&b(c.options.tracking_sites[a])})}function registerProductView(a){chrome.storage.local.get({stat:{}},function(b){b.stat[a]||(b.stat[a]={}),b.stat[a].visits||(b.stat[a].visits={}),b.stat[a].visits.product||(b.stat[a].visits.product={});var c=new Date,d={day:c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay(),week:c.getFullYear()+"--"+c.getWeekNumber(),month:c.getFullYear()+"-"+c.getMonth(),year:c.getFullYear()};$.each(d,function(c,d){b.stat[a].visits.product[c]||(b.stat[a].visits.product[c]={}),b.stat[a].visits.product[c][d]?b.stat[a].visits.product[c][d]++:b.stat[a].visits.product[c][d]=1}),chrome.storage.local.set({stat:b.stat})})}function locateItOnTab(a,b,c,d,e){GdePosylkaExt.checkTracking({tracking_number:a},function(f,g){chrome.storage.local.get(SETTINGS.local,function(h){if("unknown"==f||0==g.length){var i=chrome.i18n.getMessage("modal_unknown_tracking_title"),j=chrome.i18n.getMessage("modal_unknown_tracking_descr");createModalWindow("<div class='shoppingToolbarModalContent'><div class='shoppingToolbarModalTitle'>"+i+" — «"+a+"»</div><p>"+j+"</p></div>"),GdePosylkaExt.gaTrackEvent(c,d,e)}else if(1==g.length){var k=g[0];b&&b.content&&(k.content=b.content),b&&b.title&&(k.title=b.title),h.options.add_trackings_to_profile_allowed?GdePosylkaExt.saveTrackings(k,function(){GdePosylkaExt.openTab("/courier/"+g[0].courier.slug+"/tracking/"+g[0].tracking_number)}):GdePosylkaExt.openTab("/courier/"+g[0].courier.slug+"/tracking/"+g[0].tracking_number)}else{var l=chrome.i18n.getMessage("modal_choose_postal_service_title"),m=chrome.i18n.getMessage("modal_choose_postal_service_notify"),n="<div class='shoppingToolbarModalContent'><div style='margin:-10px -10px -10px 0;height:265px;overflow-y: scroll'><div class='shoppingToolbarModalTitle'>"+l+" «"+a+"»</div>";$.each(g,function(a,b){n+='<div class="shoppingToolbarModalTrackingItemBlock" data-shopping-toolbar-courier="'+b.courier.slug+'" data-shopping-toolbar-tracking-number="'+b.tracking_number+'"><img class="shoppingToolbarModalTrackingItemBlockCourierImage" src="https://gdeposylka.ru/img/icons/128x128/'+b.courier.slug+'.png" alt="'+b.courier.name+'" /><div class="shoppingToolbarModalTrackingItemBlockCourierContent"><span class="shoppingToolbarModalTrackingItemBlockTitle">'+b.tracking_number+'</span><span class="shoppingToolbarModalTrackingItemBlockCourier">'+b.courier.name+"</span></div></div>"}),n+="</div></div>",n+=$("<div>").addClass("shoppingToolbarModalFooter").html([$("<input>",jQuery.extend({type:"checkbox"},h.options.add_trackings_to_profile_allowed?{checked:"checked"}:{})).addClass("shoppingToolbarModalTrackingItemBlockNotifyFlag")," ",m]).prop("outerHTML"),n+="</div>",createModalWindow(n,function(a){$(".shoppingToolbarModalTrackingItemBlock",a).click(function(){var a,c=$(this).data("shopping-toolbar-courier"),d=$(this).data("shopping-toolbar-tracking-number");for(a in g)if(g.hasOwnProperty(a)){var e=g[a];if(c==e.courier.slug){b&&b.content&&(e.content=b.content),b&&b.title&&(e.title=b.title),$(".shoppingToolbarModalTrackingItemBlockNotifyFlag:checked")?GdePosylkaExt.saveTrackings(e,function(){GdePosylkaExt.openTab("/courier/"+c+"/tracking/"+d)}):GdePosylkaExt.openTab("/courier/"+c+"/tracking/"+d);break}}})})}})})}function ajaxLocal(a){GdeposylkaState.get(function(b,c,d){return a=a||{},"/"==a.url.charAt(0)&&(a.url=GdeposylkaState.getHost(b)+a.url),a.data=a.data||{},a.data.token=c,a.data.uuid=d,a.data=JSON.stringify(a.data),a.method="POST",a.dataType="json",a.cache=!1,a.timeout=2e4,a=$.extend({beforeSend:function(a){a.setRequestHeader("X-Chrome-Toolbar","ShoppingToolbar")}},a),$.ajax(a)})}function getIntFromHml(a){return parseInt($.trim(a.replace(/<(?:.|\n)*?>/gm,"").replace(/,/g,"").replace(/%/g,"")))}function getFloatFromHtml(a){return parseFloat($.trim(a.replace(/<(?:.|\n)*?>/gm,"").replace(/,/g,"").replace(/%/g,"")))}function roughSizeOfObject(a){for(var b=[],c=[a],d=0;c.length;){var e=c.pop();if("boolean"==typeof e)d+=4;else if("string"==typeof e)d+=2*e.length;else if("number"==typeof e)d+=8;else if("object"==typeof e&&-1===b.indexOf(e)){b.push(e);for(var f in e)c.push(e[f])}}var g=d+"b";return d>1073741824?g=parseFloat(d/1073741824).toFixed(2)+"Gb":d>1048576?g=parseFloat(d/1048576).toFixed(2)+"Mb":d>1024&&(g=parseFloat(d/1024).toFixed(2)+"Kb"),g}function extractDomain(a){var b;return b=a.indexOf("://")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0]}var GdePosylkaExt={gaTrackEvent:function(a,b,c){chrome.runtime.sendMessage({command:"track_event",category:a,action:b,label:c})},openTab:function(a,b,c,d){chrome.runtime.sendMessage({command:"goto_url",url:a,category:b,action:c,label:d})},locateTracking:function(a,b,c,d){chrome.runtime.sendMessage({command:"locate_it",tracking:a,category:b,action:c,label:d})},setBadgeText:function(a){parseInt(a)>100&&(a="∞"),parseInt(a)||(a=""),chrome.browserAction.setBadgeText({text:a.toString()}),chrome.browserAction.setTitle({title:chrome.i18n.getMessage("button_badge_title")}),chrome.browserAction.setBadgeBackgroundColor({color:"#CC0000"})},setIconActive:function(){chrome.browserAction.setIcon({path:{19:"img/icons/logo-32-wbg.png"}})},setIconInactive:function(){chrome.browserAction.setIcon({path:{19:"img/icons/logo-32-bw.png"}})},updateUserInfo:function(a,b){toolbarDebug&&console.log("User information requested"),GdeposylkaState.get(function(c,d){a&&(c=a),ajaxLocal({url:GdeposylkaState.getHost(c)+"/api/t1/userinfo",success:function(a){toolbarDebug&&console.log("User information acquired: ",a);var c=!1;a&&a.token&&a.email&&a.tracking_count?(GdeposylkaState.setToken(a.token),chrome.storage.local.set({userinfo:{id:a.id,username:a.email.split("@")[0],unread_count:parseInt(a.tracking_count.unread),tracking_count:parseInt(a.tracking_count["default"]),archive_tracking_count:parseInt(a.tracking_count.archive)}}),GdePosylkaExt.setIconActive(),GdeposylkaState.setLocale(a.locale),d||chrome.gcm.register(["16005987020"],GdePosylkaExt.subscribeToken),c=!0):(GdeposylkaState.setToken(null),chrome.storage.local.set({userinfo:{id:null,username:null,unread_count:null,tracking_count:null,archive_tracking_count:null}}),GdePosylkaExt.setIconInactive()),GdePosylkaExt.setBadgeText(a&&a.tracking_count&&a.tracking_count.unread?a.tracking_count.unread:""),b&&b(c)}})})},generateGoUrlSync:function(a){return GdePosylkaExt.generateGoUrlByToken(GdeposylkaState.getTokenSync(),GdeposylkaState.getLocaleSync(),a)},generateGoUrl:function(a,b){GdeposylkaState.get(function(c,d){b(GdePosylkaExt.generateGoUrlByToken(d,c,a))})},generateGoUrlByToken:function(a,b,c){return a?GdeposylkaState.getHost(b)+"/api/t1/go?token="+a+"&addr="+encodeURIComponent(GdeposylkaState.getHost(b)+c):GdeposylkaState.getHost(b)+c},subscribeToken:function(a){GdeposylkaState.get(function(b,c){c&&ajaxLocal({url:"/api/t1/subscribe",data:{platform:"gcm-chrome-ext",address:a},success:function(){toolbarDebug&&console.log("Subscribe success: ",a)}})})},detectLetyshops:function(a){var b;b=new Image,b.src="chrome-extension://lphicbbhfmllgmomkkhjfkpbdlncafbn/images/btn/logo18.png",b.onload=function(){a(!0)},b.onerror=function(){a(!1)}},checkTracking:function(a,b){ajaxLocal({url:"/api/t1/check-trackings",data:{trackings:[a]},success:function(a){a.trackings&&b(a.trackings[0].result_type,a.trackings[0].result)}})},saveTrackings:function(a,b){ajaxLocal({url:"/api/t1/save-trackings",data:{trackings:[a]},success:function(){b()}})},saveStore:function(a,b,c){c&&(ajaxLocal({url:"/api/t1/save-store",data:{store:b}}),chrome.storage.local.get({stores:{}},function(d){d.stores[c]=d.stores[c]||{},b.updatedAt=Date.now(),d.stores[c][a]=b,chrome.storage.local.set({stores:d.stores})}))}};Date.prototype.getWeekNumber=function(){var a=new Date(+this);return a.setHours(0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7)),Math.ceil(((a-new Date(a.getFullYear(),0,1))/864e5+1)/7)},!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(arguments.length>1&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setMilliseconds(k.getMilliseconds()+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b)}}),!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):"object"==typeof exports?b(a,require("jquery")):b(a,a.jQuery||a.Zepto)}(this,function(a,b){"use strict";function c(a){if(w&&"none"===a.css("animation-name")&&"none"===a.css("-webkit-animation-name")&&"none"===a.css("-moz-animation-name")&&"none"===a.css("-o-animation-name")&&"none"===a.css("-ms-animation-name"))return 0;var b,c,d,e,f=a.css("animation-duration")||a.css("-webkit-animation-duration")||a.css("-moz-animation-duration")||a.css("-o-animation-duration")||a.css("-ms-animation-duration")||"0s",g=a.css("animation-delay")||a.css("-webkit-animation-delay")||a.css("-moz-animation-delay")||a.css("-o-animation-delay")||a.css("-ms-animation-delay")||"0s",h=a.css("animation-iteration-count")||a.css("-webkit-animation-iteration-count")||a.css("-moz-animation-iteration-count")||a.css("-o-animation-iteration-count")||a.css("-ms-animation-iteration-count")||"1";for(f=f.split(", "),g=g.split(", "),h=h.split(", "),e=0,c=f.length,b=Number.NEGATIVE_INFINITY;c>e;e++)d=parseFloat(f[e])*parseInt(h[e],10)+parseFloat(g[e]),d>b&&(b=d);return b}function d(){if(b(document.body).height()<=b(window).height())return 0;var a,c,d=document.createElement("div"),e=document.createElement("div");return d.style.visibility="hidden",d.style.width="100px",document.body.appendChild(d),a=d.offsetWidth,d.style.overflow="scroll",e.style.width="100%",d.appendChild(e),c=e.offsetWidth,d.parentNode.removeChild(d),a-c}function e(){if(!x){var a,c,e=b("html"),f=k("is-locked");e.hasClass(f)||(c=b(document.body),a=parseInt(c.css("padding-right"),10)+d(),c.css("padding-right",a+"px"),e.addClass(f))}}function f(){if(!x){var a,c,e=b("html"),f=k("is-locked");e.hasClass(f)&&(c=b(document.body),a=parseInt(c.css("padding-right"),10)-d(),c.css("padding-right",a+"px"),e.removeClass(f))}}function g(a,b,c,d){var e=k("is",b),f=[k("is",u.CLOSING),k("is",u.OPENING),k("is",u.CLOSED),k("is",u.OPENED)].join(" ");a.$bg.removeClass(f).addClass(e),a.$overlay.removeClass(f).addClass(e),a.$wrapper.removeClass(f).addClass(e),a.$modal.removeClass(f).addClass(e),a.state=b,!c&&a.$modal.trigger({type:b,reason:d},[{reason:d}])}function h(a,d,e){var f=0,g=function(a){a.target===this&&f++},h=function(a){a.target===this&&0===--f&&(b.each(["$bg","$overlay","$wrapper","$modal"],function(a,b){e[b].off(r+" "+s)}),d())};b.each(["$bg","$overlay","$wrapper","$modal"],function(a,b){e[b].on(r,g).on(s,h)}),a(),0===c(e.$bg)&&0===c(e.$overlay)&&0===c(e.$wrapper)&&0===c(e.$modal)&&(b.each(["$bg","$overlay","$wrapper","$modal"],function(a,b){e[b].off(r+" "+s)}),d())}function i(a){a.state!==u.CLOSED&&(b.each(["$bg","$overlay","$wrapper","$modal"],function(b,c){a[c].off(r+" "+s)}),a.$bg.removeClass(a.settings.modifier),a.$overlay.removeClass(a.settings.modifier).hide(),a.$wrapper.hide(),f(),g(a,u.CLOSED,!0))}function j(a){var b,c,d,e,f={};for(a=a.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,","),b=a.split(","),e=0,c=b.length;c>e;e++)b[e]=b[e].split(":"),d=b[e][1],("string"==typeof d||d instanceof String)&&(d="true"===d||("false"===d?!1:d)),("string"==typeof d||d instanceof String)&&(d=isNaN(d)?d:+d),f[b[e][0]]=d;return f}function k(){for(var a=q,b=0;b<arguments.length;++b)a+="-"+arguments[b];return a}function l(){var a,c,d=location.hash.replace("#","");if(d){try{c=b("[data-"+p+'-id="'+d+'"]')}catch(e){}c&&c.length&&(a=b[p].lookup[c.data(p)],a&&a.settings.hashTracking&&a.open())}else n&&n.state===u.OPENED&&n.settings.hashTracking&&n.close()}function m(a,c){var d=b(document.body),e=this;e.settings=b.extend({},t,c),e.index=b[p].lookup.push(e)-1,e.state=u.CLOSED,e.$overlay=b("."+k("overlay")),e.$overlay.length||(e.$overlay=b("<div>").addClass(k("overlay")+" "+k("is",u.CLOSED)).hide(),d.append(e.$overlay)),e.$bg=b("."+k("bg")).addClass(k("is",u.CLOSED)),e.$modal=a.addClass(q+" "+k("is-initialized")+" "+e.settings.modifier+" "+k("is",u.CLOSED)).attr("tabindex","-1"),e.$wrapper=b("<div>").addClass(k("wrapper")+" "+e.settings.modifier+" "+k("is",u.CLOSED)).hide().append(e.$modal),d.append(e.$wrapper),e.$wrapper.on("click."+q,"[data-"+p+'-action="close"]',function(a){a.preventDefault(),e.close()}),e.$wrapper.on("click."+q,"[data-"+p+'-action="cancel"]',function(a){a.preventDefault(),e.$modal.trigger(v.CANCELLATION),e.settings.closeOnCancel&&e.close(v.CANCELLATION)}),e.$wrapper.on("click."+q,"[data-"+p+'-action="confirm"]',function(a){a.preventDefault(),e.$modal.trigger(v.CONFIRMATION),e.settings.closeOnConfirm&&e.close(v.CONFIRMATION)}),e.$wrapper.on("click."+q,function(a){var c=b(a.target);c.hasClass(k("wrapper"))&&e.settings.closeOnOutsideClick&&e.close()})}var n,o,p="shoppingToolbarModal",q=a.REMODAL_GLOBALS&&a.REMODAL_GLOBALS.NAMESPACE||p,r=b.map(["animationstart","webkitAnimationStart","MSAnimationStart","oAnimationStart"],function(a){return a+"."+q}).join(" "),s=b.map(["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"],function(a){return a+"."+q}).join(" "),t=b.extend({hashTracking:!0,closeOnConfirm:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:""},a.REMODAL_GLOBALS&&a.REMODAL_GLOBALS.DEFAULTS),u={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened"},v={CONFIRMATION:"confirmation",CANCELLATION:"cancellation"},w=function(){var a=document.createElement("div").style;return void 0!==a.animationName||void 0!==a.WebkitAnimationName||void 0!==a.MozAnimationName||void 0!==a.msAnimationName||void 0!==a.OAnimationName}(),x=/iPad|iPhone|iPod/.test(navigator.platform);m.prototype.open=function(){var a,c=this;c.state!==u.OPENING&&c.state!==u.CLOSING&&(a=c.$modal.attr("data-"+p+"-id"),a&&c.settings.hashTracking&&(o=b(window).scrollTop(),location.hash=a),n&&n!==c&&i(n),n=c,e(),c.$bg.addClass(c.settings.modifier),c.$overlay.addClass(c.settings.modifier).show(),c.$wrapper.show().scrollTop(0),c.$modal.focus(),h(function(){g(c,u.OPENING)},function(){g(c,u.OPENED)},c))},m.prototype.close=function(a){var c=this;c.state!==u.OPENING&&c.state!==u.CLOSING&&(c.settings.hashTracking&&c.$modal.attr("data-"+p+"-id")===location.hash.substr(1)&&(location.hash="",b(window).scrollTop(o)),h(function(){g(c,u.CLOSING,!1,a)},function(){c.$bg.removeClass(c.settings.modifier),c.$overlay.removeClass(c.settings.modifier).hide(),c.$wrapper.hide(),f(),g(c,u.CLOSED,!1,a)},c))},m.prototype.getState=function(){return this.state},m.prototype.destroy=function(){var a,c=b[p].lookup;i(this),this.$wrapper.remove(),delete c[this.index],a=b.grep(c,function(a){return!!a}).length,0===a&&(this.$overlay.remove(),this.$bg.removeClass(k("is",u.CLOSING)+" "+k("is",u.OPENING)+" "+k("is",u.CLOSED)+" "+k("is",u.OPENED)))},b[p]={lookup:[]},b.fn[p]=function(a){var c,d;return this.each(function(e,f){d=b(f),null==d.data(p)?(c=new m(d,a),d.data(p,c.index),c.settings.hashTracking&&d.attr("data-"+p+"-id")===location.hash.substr(1)&&c.open()):c=b[p].lookup[d.data(p)]}),c},b(document).ready(function(){b(document).on("click","[data-"+p+"-target]",function(a){a.preventDefault();var c=a.currentTarget,d=c.getAttribute("data-"+p+"-target"),e=b("[data-"+p+'-id="'+d+'"]');b[p].lookup[e.data(p)].open()}),b(document).find("."+q).each(function(a,c){var d=b(c),e=d.data(p+"-options");e?("string"==typeof e||e instanceof String)&&(e=j(e)):e={},d[p](e)}),b(document).on("keydown."+q,function(a){n&&n.settings.closeOnEscape&&n.state===u.OPENED&&27===a.keyCode&&n.close()}),b(window).on("hashchange."+q,l)})});