function renderUserInfo(){GdeposylkaState.get(function(a,b){chrome.storage.local.get({userinfo:{username:null,unread_count:null,tracking_count:null,archive_tracking_count:null}},function(c){function d(){GdeposylkaState.setToken(null),GdeposylkaState.setLocale(null),chrome.storage.local.remove("userinfo"),GdePosylkaExt.setIconInactive(),GdePosylkaExt.setBadgeText(0)}var e=c.userinfo;$("h1 a").attr("href",GdePosylkaExt.generateGoUrlSync("/")),$(".gp-tracks-link").attr("href",GdePosylkaExt.generateGoUrlSync("/tracks")),$(".gp-tracks-archive-link").attr("href",GdePosylkaExt.generateGoUrlSync("/tracks/archive")),"ru"==a&&$(".only-ru").removeClass("hide"),$(".tracking-input-button").off("click").click(function(a){a.preventDefault(),GdePosylkaExt.locateTracking($(".tracking-input").val(),"Отслеживание","Основное окно","Основная форма")}),b?($(".only-logged").removeClass("hide"),$(".only-anon").addClass("hide"),$(".btn-profile").html(e.username).attr("href",GdePosylkaExt.generateGoUrlSync("/auth/profile")),$(".btn-logout").attr("href",GdePosylkaExt.generateGoUrlSync("/auth/logout")).off("click").click(d),!parseInt(e.unread_count)&&(e.unread_count=0),!parseInt(e.tracking_count)&&(e.tracking_count=0),!parseInt(e.archive_tracking_count)&&(e.archive_tracking_count=0),parseInt(e.unread_count)?$("[data-user-json='unread_count']").removeClass("hide").html(parseInt(e.unread_count)):$("[data-user-json='unread_count']").addClass("hide"),$("[data-user-json='tracking_count']").html(parseInt(e.tracking_count)),$("[data-user-json='archive_tracking_count']").html(parseInt(e.archive_tracking_count))):($(".only-logged").addClass("hide"),$(".only-anon").removeClass("hide"),$(".btn-login").attr("href",GdePosylkaExt.generateGoUrlSync("/auth/login")),$(".btn-register").attr("href",GdePosylkaExt.generateGoUrlSync("/auth/login"))),replaceDataI18n()})})}function renderReview(){GdeposylkaState.get(function(a){chrome.storage.sync.get({rate_it:{hide_forever:!1,count:0}},function(b){function c(){var a="https://chrome.google.com/webstore/detail/%D0%B3%D0%B4%D0%B5%D0%BF%D0%BE%D1%81%D1%8B%D0%BB%D0%BA%D0%B0-%D0%BE%D1%82%D1%81%D0%BB%D0%B5%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF/pleaojdbmipmniiafnfmiainmdhkomgn/reviews?hl=ru";chrome.tabs.create({url:a,selected:!0},function(){e()})}function d(){var a="https://chrome.google.com/webstore/detail/%D0%B3%D0%B4%D0%B5%D0%BF%D0%BE%D1%81%D1%8B%D0%BB%D0%BA%D0%B0-%D0%BE%D1%82%D1%81%D0%BB%D0%B5%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF/pleaojdbmipmniiafnfmiainmdhkomgn/support?hl=ru";chrome.tabs.create({url:a,selected:!0},function(){e()})}function e(){$(".rate-it").remove(),f.hide_forever=!0,chrome.storage.sync.set({rate_it:f})}var f=b.rate_it,g=f.count%15;f.count++,chrome.storage.sync.set({rate_it:f}),"ru"==a&&!f.hide_forever&&g>5&&10>=g&&($('<div class="list-group-item rate-it"><div class="header">Понравилось расширение?</div><button class="iam-not-like-it">Не очень</button> <button class="yes-i-like-it">Да, полезно</button></div>').appendTo($(".dashboard")),GdePosylkaExt.gaTrackEvent("Оставить отзыв","Отобразился блок с диалогом",f.count),$(".iam-not-like-it").click(function(){GdePosylkaExt.gaTrackEvent("Оставить отзыв","Приложение не понравилось",f.count),$(".rate-it").html('<div class="header">Расскажите в двух словах что не так?</div><button class="no-thanks">Нет, спасибо</button> <button class="yes-sure">Да, конечно</button>'),$(".yes-sure").click(function(){GdePosylkaExt.gaTrackEvent("Оставить отзыв","Пользователь перешел в поддержку",f.count),d()}),$(".no-thanks").click(function(){GdePosylkaExt.gaTrackEvent("Оставить отзыв","Пользователь отказался оставить предложение",f.count),e()})}),$(".yes-i-like-it").click(function(){$(".rate-it").html('<div class="header">Как на счёт оценить в Chrome Web Store?</div><button class="no-thanks">Нет, спасибо</button> <button class="yes-sure">Да, конечно</button>'),$(".yes-sure").click(function(){GdePosylkaExt.gaTrackEvent("Оставить отзыв","Пользователь перешел к отзывам",f.count),c()}),$(".no-thanks").click(function(){GdePosylkaExt.gaTrackEvent("Оставить отзыв","Пользователь отказался оценить",f.count),e()})}))})})}$(function(){$('[data-toggle="tooltip"]').tooltip(),$(".main h1 sup").html(chrome.app.getDetails().version),chrome.runtime.sendMessage({command:"track_event",category:"Основное окно",action:"Открытие окна",label:"Нажатие на инконку приложения"}),$("a").on("click",function(a){$(this).data("link")&&chrome.runtime.sendMessage({command:"track_event",category:"Основное окно",action:"click",label:$(this).data("link")}),"gp-aliexpress"==$(this).data("link")&&(a.preventDefault(),GdePosylkaExt.detectLetyshops(function(a){a?$('<form action="https://trade.aliexpress.com/order_list.htm" method="GET" target="_blank"></form>').submit():$('<form action="https://gdeposylka.ru/china/aliexpress" method="POST" target="_blank"></form>').submit()}))}),GdePosylkaExt.detectLetyshops(function(a){a||$(".gp-letyshops-link").show()}),renderUserInfo(),GdePosylkaExt.updateUserInfo("ru",function(a){a?(renderUserInfo(),renderReview()):GdePosylkaExt.updateUserInfo("en",function(){renderUserInfo(),renderReview()})})});