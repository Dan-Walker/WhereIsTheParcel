function analyzeAliOrders(a){void 0===a.orders[marketList.ali]&&(a.orders[marketList.ali]={});var b,c,d,e,f=[],g=0,h={};$.each($(".order-head .order-info .first-row .info-body"),function(){g++,c=$(this).html().replace(/[^\d]+/g,""),b=$(this).parent().parent().parent().parent(),h[c]=b,void 0===a.orders[marketList.ali][c]&&(a.orders[marketList.ali][c]={}),void 0==a.orders[marketList.ali][c].products&&(a.orders[marketList.ali][c].products={}),$.each($(".order-body",b),function(){d={},d.id=$(".product-right .product-title a",$(this)).attr("productid"),d.order_id=c,d.image=$(".product-left .pic img",$(this)).attr("src").replace("_50x50.jpg",""),d.title=$(".product-right .product-title a",$(this)).html(),d.url=$(".product-right .product-title a",$(this)).attr("href"),a.orders[marketList.ali][c].products[d.id]=d}),a.orders[marketList.ali][c].id=c,a.orders[marketList.ali][c].createDate=$(".second-row .info-body",$(this).parent().parent()).html(),void 0==a.orders[marketList.ali][c].tracking_number?(a.orders[marketList.ali][c].tracking_number=null,f.push(c)):(e=a.orders[marketList.ali][c].tracking_number,placeTrackingLinks(e,c,b,a))}),chrome.storage.local.set({orders:a.orders},function(){var b=f.length;$.each(f,function(){var c=(Date.now()-a.orders[marketList.ali][this].tracking_number_check_date)/1e6>864e5;a.orders[marketList.ali][this].tracking_number||a.orders[marketList.ali][this].tracking_number_check_date&&!c?b--:matchTrackingNumberByOrder(this.toString(),function(c){a.orders[marketList.ali][c.orderId].tracking_number=c.tracking_number,a.orders[marketList.ali][c.orderId].tracking_number_check_date=c.tracking_number_check_date,placeTrackingLinks(c.tracking_number,c.orderId,h[c.orderId],a),0==--b&&chrome.storage.local.set({orders:a.orders})})})})}function placeTrackingLinks(a,b,c,d){if(null!=a){globalCounter++;var e=chrome.i18n.getMessage("track_number_header"),f=GdePosylkaExt.generateGoUrlSync("/detect/"+a),g=chrome.i18n.getMessage("track_on")+" "+chrome.i18n.getMessage("brand_color");$('<a data-tracking="'+a+'" href="'+f+'" target="_blank" class="ali-track-link_'+globalCounter+'">'+g+"</a>").appendTo($(".order-action",c)),$('<br/><div style="font-weight: bold;font-size:11px;">'+e+'</div><div style="font-weight: bold;font-size:14px;margin-bottom:6px;">'+a+'</div><button style="margin-right:8px;" data-tracking="'+a+'" class="ui-button ui-button-normal ali-track-button_'+globalCounter+'" type="button">'+g+"</button>").appendTo($(".product-action",c));var h={content:[]};$.each(d.orders[marketList.ali][b].products,function(){h.content.push(this)}),void 0!==h.content[0]&&(h.title=h.content[0].title),$(".ali-track-link_"+globalCounter).click(function(b){b.preventDefault(),locateItOnTab(a,h,"Отслеживание","АлиЭкспресс: страница списка заказов","Ссылка")}),$(".ali-track-button_"+globalCounter).click(function(b){b.preventDefault(),locateItOnTab(a,h,"Отслеживание","АлиЭкспресс: страница списка заказов","Кнопка")})}}function matchTrackingNumberByOrder(a,b){var c="https://trade.aliexpress.com/order_detail.htm?orderId="+a;$.ajax(c).done(function(c){var d=null;$(c).find(".shipping-table #logistic-item1 .no").length&&(d=$.trim($(c).find(".shipping-table #logistic-item1 .no").html().replace(/<(?:.|\n)*?>/gm,""))),b({orderId:a,tracking_number:d,tracking_number_check_date:Date.now()})})}checkSiteAllowedForTracking("aliexpress.com",function(){chrome.storage.local.get(SETTINGS.local,function(a){analyzeAliOrders(a)})});var globalCounter=0;